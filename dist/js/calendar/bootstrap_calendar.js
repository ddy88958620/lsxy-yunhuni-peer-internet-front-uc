$.fn.calendar=function(a){var t=$.extend({},$.fn.calendar.defaults,a);return this.each(function(){function a(){f=$('<table class="daysmonth table table">'),r();var a=new Date,t=D.val();if(""!=t&&l(t)){var o=t.split("/");2==o[2].length&&("0"==o[2].charAt(0)&&(o[2]=o[2].substring(1)),o[2]=parseInt(o[2]),o[2]<50&&(o[2]+=2e3)),a=new Date(o[2],o[1]-1,o[0])}var p=a.getMonth(),s=a.getFullYear();n(p,s);var c=$('<td><i class="fa fa-arrow-right"></i></td>');c.click(function(a){a.stopPropagation(),a.preventDefault(),p=(p+1)%12,0==p&&s++,e(p,s)});var v=$('<td><i class="fa fa-arrow-left"></i></td>');v.click(function(a){a.stopPropagation(),a.preventDefault(),p-=1,p==-1&&(s--,p=11),e(p,s)}),$(".icon-arrow-left").css("cursor","pointer"),$(".icon-arrow-right").css("cursor","pointer");var g=$('<table class="table header"><tr></tr></table>'),h=$('<td colspan=5 class="year span6"></td>');g.append(v),g.append(h),g.append(c),h.append(u),d=$('<div class="calendar" id="'+_+'" ></div>'),d.prepend(g),d.append(f),D.append(d),i(p,s)}function e(a,t){f.empty(),r(),n(a,t),i(a,t)}function r(){if(0!=y){var a=$('<tr class="week_days" >'),t="";$(v).each(function(a,e){t+="<td",0==a&&(t+=' class="first"'),6==a&&(t+=' class="last"'),t+=">"+e+"</td>"}),t+="</tr>",a.append(t),f.append(a)}}function n(a,t){u.text(h[a]+" "+t);for(var e=1,r=o(1,a,t),n=s(a,t),p=a+1,l="",i=0;i<7;i++){if(i<r){var c="";0==i&&(c+="<tr>"),c+='<td class="invalid',0==i&&(c+=" first"),c+='"></td>'}else{var c="";0==i&&(c+="<tr>"),c+='<td id="'+_+"_"+e+"_"+p+"_"+t+'" ',0==i&&(c+=' class="first"'),6==i&&(c+=' class="last"'),c+="><a>"+e+"</a></span>",6==i&&(c+="</tr>"),e++}l+=c}for(var d=1;e<=n;){var c="";d%7==1&&(c+="<tr>"),c+='<td id="'+_+"_"+e+"_"+p+"_"+t+'" ',d%7==1&&(c+=' class="first"'),d%7==0&&(c+=' class="last"'),c+="><a>"+e+"</a></td>",d%7==0&&(c+="</tr>"),e++,d++,l+=c}if(d--,d%7!=0){c="";for(var i=d%7+1;i<=7;i++){var c="";c+='<td class="invalid',7==i&&(c+=" last"),c+='"></td>',7==i&&(c+="</tr>"),l+=c}}f.append(l)}function o(a,t,e){var r=new Date(e,t,a),n=r.getDay();return n}function p(a,t,e){return a>0&&a<13&&e>0&&e<32768&&t>0&&t<=new Date(e,a,0).getDate()}function s(a,t){for(var e=28;p(a+1,e+1,t);)e++;return e}function l(a){var t=a.split("/");return 3==t.length&&p(t[1],t[0],t[2])}function i(a,t){0!=w?$.ajax({type:w.type,url:w.url,data:{month:a+1,year:t},dataType:"json"}).done(function(e){g=[],$.each(e,function(a,t){g.push(e[a])}),c(a,t)}):c(a,t)}function c(a,t){for(var e=a+1,r=0;r<g.length;r++)if(g[r][0].split("/")[1]==e&&g[r][0].split("/")[2]==t){if($("#"+_+"_"+g[r][0].replace(/\//g,"_")).addClass("event"),$("#"+_+"_"+g[r][0].replace(/\//g,"_")+" a").attr("data-original-title",g[r][1]),g[r][3]){var n=$("#"+_+"_"+g[r][0].replace(/\//g,"_"));n.append("<span></span>").find("span").css("background",g[r][3])}""==g[r][2]||"#"==g[r][2]?""!=g[r][4]?($("#"+_+"_"+g[r][0].replace(/\//g,"_")+" a").attr("data-trigger","manual"),$("#"+_+"_"+g[r][0].replace(/\//g,"_")+" a").addClass("manual_popover")):$("#"+_+"_"+g[r][0].replace(/\//g,"_")+" a").attr("href","javascript:false;"):$("#"+_+"_"+g[r][0].replace(/\//g,"_")+" a").attr("href",g[r][2]),g[r][4]?($("#"+_+"_"+g[r][0].replace(/\//g,"_")).addClass("event_popover"),$("#"+_+"_"+g[r][0].replace(/\//g,"_")+" a").attr("rel","popover"),$("#"+_+"_"+g[r][0].replace(/\//g,"_")+" a").attr("data-content",g[r][4])):($("#"+_+"_"+g[r][0].replace(/\//g,"_")).addClass("event_tooltip"),$("#"+_+"_"+g[r][0].replace(/\//g,"_")+" a").attr("rel","tooltip"))}$("#"+_+" .event_tooltip a").tooltip(b),$("#"+_+" .event_popover a").popover(m),$(".manual_popover").click(function(){$(this).popover("toggle")})}var d,f,v,u=$('<div class="visualmonthyear"></div>'),_="cal_"+Math.floor(99999*Math.random()).toString(36),g=t.events;v="undefined"!=typeof t.days?t.days:["S","M","T","W","T","F","S"];var h;h="undefined"!=typeof t.months?t.months:["January","February","March","April","May","June","July","August","September","October","November","December"];var y;y="undefined"==typeof t.show_days||t.show_days;var m;m="undefined"!=t.popover_options?t.popover_options:{placement:"top"};var b;b="undefined"!=typeof t.tooltip_options?t.tooltip_options:{placement:"top"};var w;w="undefined"!=typeof t.req_ajax&&t.req_ajax;var D=$(this);a()}),this};