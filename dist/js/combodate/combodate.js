!function(t){var e=function(e,i){return this.$element=t(e),this.$element.is("input")?(this.options=t.extend({},t.fn.combodate.defaults,i,this.$element.data()),void this.init()):void t.error("Combodate should be applied to INPUT element")};e.prototype={constructor:e,init:function(){this.map={day:["D","date"],month:["M","month"],year:["Y","year"],hour:["[Hh]","hours"],minute:["m","minutes"],second:["s","seconds"],ampm:["[Aa]",""]},this.$widget=t('<span class="combodate"></span>').html(this.getTemplate()),this.initCombos(),this.$widget.on("change","select",t.proxy(function(){this.$element.val(this.getValue())},this)),this.$widget.find("select").css("width","auto"),this.$element.hide().after(this.$widget),this.setValue(this.$element.val()||this.options.value)},getTemplate:function(){var e=this.options.template;return t.each(this.map,function(t,i){i=i[0];var o=new RegExp(i+"+"),n=i.length>1?i.substring(1,2):i;e=e.replace(o,"{"+n+"}")}),e=e.replace(/ /g,"&nbsp;"),t.each(this.map,function(t,i){i=i[0];var o=i.length>1?i.substring(1,2):i;e=e.replace("{"+o+"}",'<select class="'+t+'"></select>')}),e},initCombos:function(){var e=this;t.each(this.map,function(t,i){var o,n,s=e.$widget.find("."+t);s.length&&(e["$"+t]=s,o="fill"+t.charAt(0).toUpperCase()+t.slice(1),n=e[o](),e["$"+t].html(e.renderItems(n)))})},initItems:function(t){var e,i=[];if("name"===this.options.firstItem){e=moment.relativeTime||moment.langData()._relativeTime;var o="function"==typeof e[t]?e[t](1,!0,t,!1):e[t];o=o.split(" ").reverse()[0],i.push(["",o])}else"empty"===this.options.firstItem&&i.push(["",""]);return i},renderItems:function(t){for(var e=[],i=0;i<t.length;i++)e.push('<option value="'+t[i][0]+'">'+t[i][1]+"</option>");return e.join("\n")},fillDay:function(){var t,e,i=this.initItems("d"),o=this.options.template.indexOf("DD")!==-1;for(e=1;e<=31;e++)t=o?this.leadZero(e):e,i.push([e,t]);return i},fillMonth:function(){var t,e,i=this.initItems("M"),o=this.options.template.indexOf("MMMM")!==-1,n=this.options.template.indexOf("MMM")!==-1,s=this.options.template.indexOf("MM")!==-1;for(e=0;e<=11;e++)t=o?moment().date(1).month(e).format("MMMM"):n?moment().date(1).month(e).format("MMM"):s?this.leadZero(e+1):e+1,i.push([e,t]);return i},fillYear:function(){var t,e,i=[],o=this.options.template.indexOf("YYYY")!==-1;for(e=this.options.maxYear;e>=this.options.minYear;e--)t=o?e:(e+"").substring(2),i[this.options.yearDescending?"push":"unshift"]([e,t]);return i=this.initItems("y").concat(i)},fillHour:function(){var t,e,i=this.initItems("h"),o=this.options.template.indexOf("h")!==-1,n=(this.options.template.indexOf("H")!==-1,this.options.template.toLowerCase().indexOf("hh")!==-1),s=o?1:0,a=o?12:23;for(e=s;e<=a;e++)t=n?this.leadZero(e):e,i.push([e,t]);return i},fillMinute:function(){var t,e,i=this.initItems("m"),o=this.options.template.indexOf("mm")!==-1;for(e=0;e<=59;e+=this.options.minuteStep)t=o?this.leadZero(e):e,i.push([e,t]);return i},fillSecond:function(){var t,e,i=this.initItems("s"),o=this.options.template.indexOf("ss")!==-1;for(e=0;e<=59;e+=this.options.secondStep)t=o?this.leadZero(e):e,i.push([e,t]);return i},fillAmpm:function(){var t=this.options.template.indexOf("a")!==-1,e=(this.options.template.indexOf("A")!==-1,[["am",t?"am":"AM"],["pm",t?"pm":"PM"]]);return e},getValue:function(e){var i,o={},n=this,s=!1;return t.each(this.map,function(t,e){if("ampm"!==t){var i="day"===t?1:0;return o[t]=n["$"+t]?parseInt(n["$"+t].val(),10):i,isNaN(o[t])?(s=!0,!1):void 0}}),s?"":(this.$ampm&&(12===o.hour?o.hour="am"===this.$ampm.val()?0:12:o.hour="am"===this.$ampm.val()?o.hour:o.hour+12),i=moment([o.year,o.month,o.day,o.hour,o.minute,o.second]),this.highlight(i),e=void 0===e?this.options.format:e,null===e?i.isValid()?i:null:i.isValid()?i.format(e):"")},setValue:function(e){function i(e,i){var o={};return e.children("option").each(function(e,n){var s,a=t(n).attr("value");""!==a&&(s=Math.abs(a-i),("undefined"==typeof o.distance||s<o.distance)&&(o={value:a,distance:s}))}),o.value}if(e){var o="string"==typeof e?moment(e,this.options.format):moment(e),n=this,s={};o.isValid()&&(t.each(this.map,function(t,e){"ampm"!==t&&(s[t]=o[e[1]]())}),this.$ampm&&(s.hour>=12?(s.ampm="pm",s.hour>12&&(s.hour-=12)):(s.ampm="am",0===s.hour&&(s.hour=12))),t.each(s,function(t,e){n["$"+t]&&("minute"===t&&n.options.minuteStep>1&&n.options.roundTime&&(e=i(n["$"+t],e)),"second"===t&&n.options.secondStep>1&&n.options.roundTime&&(e=i(n["$"+t],e)),n["$"+t].val(e))}),this.$element.val(o.format(this.options.format)))}},highlight:function(t){t.isValid()?this.options.errorClass?this.$widget.removeClass(this.options.errorClass):this.$widget.find("select").css("border-color",this.borderColor):this.options.errorClass?this.$widget.addClass(this.options.errorClass):(this.borderColor||(this.borderColor=this.$widget.find("select").css("border-color")),this.$widget.find("select").css("border-color","red"))},leadZero:function(t){return t<=9?"0"+t:t},destroy:function(){this.$widget.remove(),this.$element.removeData("combodate").show()}},t.fn.combodate=function(i){var o,n=Array.apply(null,arguments);return n.shift(),"getValue"===i&&this.length&&(o=this.eq(0).data("combodate"))?o.getValue.apply(o,n):this.each(function(){var o=t(this),s=o.data("combodate"),a="object"==typeof i&&i;s||o.data("combodate",s=new e(this,a)),"string"==typeof i&&"function"==typeof s[i]&&s[i].apply(s,n)})},t.fn.combodate.defaults={format:"DD-MM-YYYY HH:mm",template:"D / MMM / YYYY   H : mm",value:null,minYear:1970,maxYear:2015,yearDescending:!0,minuteStep:5,secondStep:1,firstItem:"empty",errorClass:null,roundTime:!0}}(window.jQuery);